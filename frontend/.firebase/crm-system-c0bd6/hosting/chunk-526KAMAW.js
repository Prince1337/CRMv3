import{a as k}from"./chunk-R3BKSPTG.js";import{d as w}from"./chunk-ASJLSJFH.js";import"./chunk-562UQ2XR.js";import{d as D}from"./chunk-BYEZXU77.js";import{$a as c,Ia as p,Jb as M,Ka as u,Ma as C,Na as i,Nb as O,Oa as t,Sa as v,Ta as l,Ua as d,W as _,Za as n,_a as m,ab as S,ca as h,da as x,gb as P,va as o,wa as g}from"./chunk-ZEIBLRTY.js";import"./chunk-CWTPBX7D.js";function E(a,f){if(a&1&&(i(0,"div",8)(1,"strong"),n(2,"Registriert:"),t(),n(3),t()),a&2){let e=d();o(3),c(" ",e.formatDate(e.currentUser==null?null:e.currentUser.createdAt)," ")}}function U(a,f){if(a&1&&(i(0,"div",8)(1,"strong"),n(2,"Letzter Login:"),t(),n(3),t()),a&2){let e=d();o(3),c(" ",e.formatDate(e.currentUser==null?null:e.currentUser.lastLogin)," ")}}function y(a,f){if(a&1){let e=v();i(0,"button",17),l("click",function(){h(e);let r=d();return x(r.navigateToStatistics())}),n(1," \u{1F4CA} Statistiken "),t()}}function I(a,f){if(a&1){let e=v();i(0,"div",18)(1,"div",19)(2,"h3"),n(3,"\u{1F4C8} \xDCbersicht"),t(),i(4,"button",20),l("click",function(){h(e);let r=d();return x(r.refreshStats())}),n(5," \u{1F504} "),t()(),i(6,"div",21)(7,"div",22)(8,"div",23),n(9,"\u{1F465}"),t(),i(10,"div",24)(11,"div",25),n(12),t(),i(13,"div",26),n(14,"Gesamt Kunden"),t()()(),i(15,"div",22)(16,"div",23),n(17,"\u{1F4C8}"),t(),i(18,"div",24)(19,"div",25),n(20),t(),i(21,"div",26),n(22,"In Pipeline"),t()()(),i(23,"div",22)(24,"div",23),n(25,"\u2705"),t(),i(26,"div",24)(27,"div",25),n(28),t(),i(29,"div",26),n(30,"Gewonnen"),t()()(),i(31,"div",22)(32,"div",23),n(33,"\u274C"),t(),i(34,"div",24)(35,"div",25),n(36),t(),i(37,"div",26),n(38,"Verloren"),t()()()()()}if(a&2){let e=d();o(12),m(e.customerStats.total||0),o(8),m(e.customerStats.inPipeline||0),o(8),m(e.customerStats.won||0),o(8),m(e.customerStats.lost||0)}}var V=(()=>{class a{constructor(e,s,r){this.authService=e,this.router=s,this.customerService=r,this.currentUser=null,this.customerStats={}}ngOnInit(){this.authSubscription=this.authService.authState$.subscribe(e=>{this.currentUser=e.user}),this.currentUser=this.authService.getCurrentUser(),!this.currentUser&&this.authService.isAuthenticated()&&this.authService.getUserProfile().subscribe({next:e=>{this.currentUser=e,console.log("User-Profile explizit geladen:",e)},error:e=>{console.error("Fehler beim Laden des User-Profils:",e)}}),this.loadCustomerStats()}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe()}logout(){console.log("Logout wird ausgef\xFChrt..."),this.authService.handleLogout();try{this.authService.logout().subscribe({next:e=>{console.log("Backend-Logout erfolgreich:",e)},error:e=>{console.error("Backend-Logout error:",e)}})}catch(e){console.error("Fehler beim Backend-Logout:",e)}this.router.navigate(["/login"])}getRoleDisplayName(){if(!this.currentUser?.role)return"Unbekannt";switch(this.currentUser.role){case"ROLE_ADMIN":return"Administrator";case"ROLE_USER":return"Benutzer";default:return this.currentUser.role}}isAdmin(){return this.authService.isAdmin()}navigateToCustomers(){this.router.navigate(["/customers"])}navigateToOffers(){this.router.navigate(["/offers"])}navigateToInvoices(){this.router.navigate(["/invoices"])}navigateToPipeline(){this.router.navigate(["/customers/pipeline"])}navigateToStatistics(){this.router.navigate(["/statistics"])}formatDate(e){if(!e)return"Unbekannt";try{return new Date(e).toLocaleDateString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return"Ung\xFCltiges Datum"}}loadCustomerStats(){this.customerService.getCustomerStatistics().subscribe({next:e=>{this.customerStats={total:e.totalCustomers||0,inPipeline:e.customersInPipeline||0,won:e.wonCustomers||0,lost:e.lostCustomers||0},console.log("Dashboard-Statistiken geladen:",this.customerStats)},error:e=>{console.error("Fehler beim Laden der Kunden-Statistiken:",e),this.customerStats={total:0,inPipeline:0,won:0,lost:0}}})}refreshStats(){this.loadCustomerStats()}static{this.\u0275fac=function(s){return new(s||a)(g(k),g(D),g(w))}}static{this.\u0275cmp=_({type:a,selectors:[["app-dashboard"]],standalone:!0,features:[P],decls:46,vars:12,consts:[[1,"dashboard-container"],[1,"dashboard-header"],[1,"header-content"],[1,"user-info"],[1,"logout-button",3,"click"],[1,"dashboard-main"],[1,"welcome-card"],[1,"user-details"],[1,"detail-item"],[1,"status-badge"],["class","detail-item",4,"ngIf"],[1,"quick-actions"],[1,"action-buttons"],[1,"action-button","primary",3,"click"],[1,"action-button","secondary",3,"click"],["class","action-button admin",3,"click",4,"ngIf"],["class","stats-overview",4,"ngIf"],[1,"action-button","admin",3,"click"],[1,"stats-overview"],[1,"stats-header"],["title","Statistiken aktualisieren",1,"refresh-button",3,"click"],[1,"stats-grid"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-value"],[1,"stat-label"]],template:function(s,r){s&1&&(i(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1"),n(4,"\u{1F3E2} CRM v3 Dashboard"),t(),i(5,"div",3)(6,"span"),n(7),t(),i(8,"button",4),l("click",function(){return r.logout()}),n(9," \u{1F6AA} Abmelden "),t()()()(),i(10,"main",5)(11,"div",6)(12,"h2"),n(13,"Willkommen im CRM v3"),t(),i(14,"div",7)(15,"div",8)(16,"strong"),n(17,"Benutzername:"),t(),n(18),t(),i(19,"div",8)(20,"strong"),n(21,"E-Mail:"),t(),n(22),t(),i(23,"div",8)(24,"strong"),n(25,"Rolle:"),t(),n(26),t(),i(27,"div",8)(28,"strong"),n(29,"Status:"),t(),i(30,"span",9),n(31),t()(),p(32,E,4,1,"div",10)(33,U,4,1,"div",10),t()(),i(34,"div",11)(35,"h3"),n(36,"\u{1F680} Schnellzugriff"),t(),i(37,"div",12)(38,"button",13),l("click",function(){return r.navigateToCustomers()}),n(39," \u{1F465} Kunden verwalten "),t(),i(40,"button",14),l("click",function(){return r.navigateToOffers()}),n(41," \u{1F4C4} Angebote "),t(),i(42,"button",14),l("click",function(){return r.navigateToPipeline()}),n(43," \u{1F4C8} Pipeline "),t(),p(44,y,2,0,"button",15),t()(),p(45,I,39,4,"div",16),t()()),s&2&&(o(7),S("Willkommen, ",r.currentUser==null?null:r.currentUser.firstName," ",r.currentUser==null?null:r.currentUser.lastName,""),o(11),c(" ",(r.currentUser==null?null:r.currentUser.username)||"Unbekannt"," "),o(4),c(" ",(r.currentUser==null?null:r.currentUser.email)||"Unbekannt"," "),o(4),c(" ",r.getRoleDisplayName()," "),o(4),C(r.currentUser!=null&&r.currentUser.enabled?"status-active":"status-inactive"),o(),c(" ",r.currentUser!=null&&r.currentUser.enabled?"Aktiv":"Inaktiv"," "),o(),u("ngIf",r.currentUser==null?null:r.currentUser.createdAt),o(),u("ngIf",r.currentUser==null?null:r.currentUser.lastLogin),o(11),u("ngIf",r.isAdmin()),o(),u("ngIf",r.isAdmin()))},dependencies:[O,M],styles:[".dashboard-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#f8fafc}.dashboard-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid #e2e8f0;padding:1rem 0;box-shadow:0 1px 3px #0000001a}.header-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1.5rem;display:flex;justify-content:space-between;align-items:center}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;color:#1e293b;font-size:1.5rem;font-weight:700}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.user-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#64748b;font-size:.875rem}.logout-button[_ngcontent-%COMP%]{background:#dc3545;color:#fff;border:none;padding:.5rem 1rem;border-radius:.375rem;font-size:.875rem;cursor:pointer;transition:all .2s ease;font-weight:500}.logout-button[_ngcontent-%COMP%]:hover{background:#c82333;transform:translateY(-1px);box-shadow:0 4px 6px #0000001a}.dashboard-main[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.welcome-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:.5rem;padding:1.5rem;margin-bottom:1.5rem;box-shadow:0 1px 3px #0000001a}.welcome-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;color:#1e293b;font-size:1.25rem;font-weight:600}.user-details[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1rem}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;background:#f8fafc;border-radius:.25rem;border-left:3px solid #3b82f6}.detail-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#1e293b;font-weight:600;min-width:120px}.detail-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#64748b}.status-badge[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem;font-weight:500}.status-active[_ngcontent-%COMP%]{background:#d1fae5;color:#065f46}.status-inactive[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.quick-actions[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:.5rem;padding:1.5rem;margin-bottom:1.5rem;box-shadow:0 1px 3px #0000001a}.quick-actions[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:#1e293b;font-size:1.25rem;font-weight:600}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.action-button[_ngcontent-%COMP%]{border:none;color:#fff;padding:.75rem 1rem;border-radius:.375rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease;text-decoration:none;display:inline-flex;align-items:center;gap:.5rem;min-width:160px;justify-content:center}.action-button.primary[_ngcontent-%COMP%]{background:#3b82f6}.action-button.primary[_ngcontent-%COMP%]:hover{background:#2563eb;transform:translateY(-2px);box-shadow:0 10px 15px #0000001a}.action-button.secondary[_ngcontent-%COMP%]{background:#6b7280}.action-button.secondary[_ngcontent-%COMP%]:hover{background:#4b5563;transform:translateY(-2px);box-shadow:0 10px 15px #0000001a}.action-button.admin[_ngcontent-%COMP%]{background:#f59e0b}.action-button.admin[_ngcontent-%COMP%]:hover{background:#d97706;transform:translateY(-2px);box-shadow:0 10px 15px #0000001a}.stats-overview[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:.5rem;padding:1.5rem;box-shadow:0 1px 3px #0000001a}.stats-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.stats-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#1e293b;font-size:1.25rem;font-weight:600}.refresh-button[_ngcontent-%COMP%]{background:#3b82f6;color:#fff;border:none;padding:.5rem;border-radius:.375rem;font-size:1rem;cursor:pointer;transition:all .2s ease;width:40px;height:40px;display:flex;align-items:center;justify-content:center}.refresh-button[_ngcontent-%COMP%]:hover{background:#2563eb;transform:rotate(180deg);box-shadow:0 4px 6px #0000001a}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}.stat-card[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:.5rem;padding:1rem;display:flex;align-items:center;gap:1rem;transition:all .2s ease}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 6px #0000001a}.stat-icon[_ngcontent-%COMP%]{font-size:1.5rem;width:60px;height:60px;display:flex;align-items:center;justify-content:center;background:#dbeafe;border-radius:.375rem;color:#3b82f6}.stat-content[_ngcontent-%COMP%]{flex:1}.stat-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#1e293b;margin-bottom:.25rem}.stat-label[_ngcontent-%COMP%]{font-size:.875rem;color:#64748b;font-weight:500}@media (max-width: 768px){.header-content[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;text-align:center}.user-info[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.dashboard-main[_ngcontent-%COMP%]{padding:1rem}.user-details[_ngcontent-%COMP%]{grid-template-columns:1fr}.action-buttons[_ngcontent-%COMP%]{flex-direction:column}.action-button[_ngcontent-%COMP%]{width:100%}.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.stat-card[_ngcontent-%COMP%]{flex-direction:column;text-align:center}.stat-icon[_ngcontent-%COMP%]{width:50px;height:50px;font-size:1.25rem}}"]})}}return a})();export{V as DashboardComponent};
